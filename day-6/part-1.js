const input = "..........#.....................#...................#.......................................................................#....#\n" +
    ".........#................................................................#....##......#........##.............#..................\n" +
    "............#..............#..#.................................................................#.................................\n" +
    "..............#.....#................................................................................#...........................#\n" +
    "............................................................................................................#.............#.......\n" +
    ".........#..........##......................................#......................................#......#...#.......#...#.....#.\n" +
    "..#...................................................#.................#....#........#.....#.................#...................\n" +
    ".....#............#.#..#..................#.......................#................................#......#..............#........\n" +
    "#.................................................................#..........#.......................................#.#..........\n" +
    "..##...................#..................................#..#.................................#...#..#.#.#.........#...##........\n" +
    "..#..........................#...............#...............#..........................#.................................#.......\n" +
    "................##......#......#......................##.............#........#................................#.#..#.............\n" +
    ".............................................................#.#.......................................................#..........\n" +
    ".....##.............................................#.......................#...............#...............#..#...#....#.........\n" +
    ".#.........................#..................................#..........#....#...............................................#...\n" +
    ".......................#..#.............#......#.....#..#................................................#....#........#..........\n" +
    "...............#.....................#................#...................................#......#........................#.......\n" +
    ".......................#....#..............#.......#...........................#....................................#.#...........\n" +
    "..#..................#...........#........................#............#...................#......................#.............#.\n" +
    "..............................................#........................................#..............#...........#.........#.....\n" +
    "............#.................#...#..........#.#.....................##.........#................##...........##............#.....\n" +
    "..................#.......#..................................................................#....#..................#.......#....\n" +
    "..........##......#...............................................#.................................#.......#.............#.......\n" +
    "................................................................................#.......................................#.........\n" +
    ".....#........................#.............##......................#.......#.......#...............................#.............\n" +
    "..#.......................................##........#.............#...............................................#...............\n" +
    ".............#.....#..........................................#...................#.................................#..........#..\n" +
    ".........#............#..#....................#............##.............#..................................#....................\n" +
    "........................................................#..........#.............................#................................\n" +
    "......................#..............................................................................................#............\n" +
    ".......#............#..#........................#...............#.......#.............................#......................#....\n" +
    "...................................................................................#........................#........#..#.....#.#.\n" +
    "..#.......#......#...................................................................................#..#.....#................#..\n" +
    ".....#...#......................................................#...................#.#..............................#.#..........\n" +
    "..#.#.....................#....................#...........#.................#........#..#.........#........#..................#..\n" +
    "....#......#.......#.....................................................##...........#...........................................\n" +
    "........................#......#......................#......#.....................................................#.......#......\n" +
    "............................................................#..........................#...#.#..................................#.\n" +
    ".#..........#..............................#.....#.............................................#..................................\n" +
    "#..........................................#......#.............#...........................................#.........#...........\n" +
    "......#...............................#..#......................#.....#.......#.....#..#......................#.......#...........\n" +
    "........................................#..#.................................#......#.......................#.....................\n" +
    ".#................#...........#.........#.............................................................#...........................\n" +
    ".....#.......................#....................................................................................................\n" +
    ".............#................#............................................#...........#......................#..................#\n" +
    "#........................#....#.....................#................#..##.............#......................#...#...............\n" +
    "....#....................#....#.#..................#...........................................................#......##..........\n" +
    "#............#..........##............................................................#...........................................\n" +
    "...........#..................................#..##................#..............................................................\n" +
    "..........................#..............................................................................#...............#........\n" +
    ".......................................................................#...........#...#...........#..#.....#..................#..\n" +
    ".........................#....#.......#......................#....................................#...............................\n" +
    "..#..................#...................................................#......................................#.................\n" +
    "..............#....##........................................#..................#.................................................\n" +
    "..........................#............................................#...................#............................#.........\n" +
    "......#...............................#..........................#.............................#..................................\n" +
    "...................................#.............................................................#..............#.................\n" +
    ".................#...#.......#..............#.#...........................................#.......#.....#.........................\n" +
    "........................#.......................................#..#.........................#...##...#...........................\n" +
    "....#..#.............#........#.............#..........#......#.........................................#....#..#.................\n" +
    ".......................................................................#...........#......#.....................#...........#.....\n" +
    "#.#..............................#................................................................................................\n" +
    ".#.................................................#...................#..........................................................\n" +
    "..............................#.............#.............................#.....#............#....................................\n" +
    ".#...............................#.......#...##.#.................#............................................#..................\n" +
    ".............#....#.................#.........#..............#....#...............................................................\n" +
    "......................#.#..........................................................................#................#.............\n" +
    ".#....................#.....#................#.....................#..................#......................#....................\n" +
    ".............#.#............#......................................#.......................#......................#...............\n" +
    ".#..#...#...................#.....................................................................................................\n" +
    "...........................................................................#.....................#................................\n" +
    "...........#.............................#......#.................................................................................\n" +
    "..............#.................................................#.##........#..........................#.........................#\n" +
    "..................#...#...........................................................................................................\n" +
    "........#.....#......................#..#....#...#.#......................................#.#............#........................\n" +
    ".....#..#.........................................................#......#.....#...........#..................#...#..........#....\n" +
    "......#.........................................#......................#........#...................................#.............\n" +
    "..........................................#........................#........#.............#........#..#...........................\n" +
    ".......#..............#...................#...........................................#.............#.............................\n" +
    "..............#....#....#......#...........................................................#..........................#...........\n" +
    "..................................................................................#.......#...................#...#....#..........\n" +
    ".................#........................#........#...#.....................................................#........#...........\n" +
    "...........................#......^.#..............#.#.....................#.#...........#....##.......#..........................\n" +
    ".............#.....#.........................................................................#..........#......#..#.#.............\n" +
    "...................................................................#.......#.......#...........................................#..\n" +
    ".......#.........#.......................#...................................................................#..........#.....#..#\n" +
    ".....................#...............#...#..#.....................................................#.....##.##..........#..........\n" +
    ".......................#.......#..................................#.................#.....................................#.......\n" +
    "................................................#........#....................#........................#..........................\n" +
    "......#....#..#....#.......................#....#...#.............................#............................#......#...........\n" +
    "...................................................................................................##.#.....#.................#...\n" +
    ".................#...#....................#........................#...............##.....#...........#........#.............#....\n" +
    ".....#............#......................................................................#................#....#..................\n" +
    "........#.............#..................................................................#....#.......#...........................\n" +
    ".#.......................................#.......................................#....#.............................#.............\n" +
    "...#.............................#..................#............................#.....................#.....#...........#........\n" +
    "....#......#.................................................................................................................#....\n" +
    ".....................................#..........#.............#......................................#............................\n" +
    "..#...#....#............#.....................................................#..#................................................\n" +
    ".....#.......................................................#............#..........................#...........#................\n" +
    "#.....................#..............#................................................#..........................#......#........#\n" +
    "........#.........................#........................#................#.......................#.............................\n" +
    "...........................#........#............................#.......#..............#.........................................\n" +
    "......###.........................................................................#.........#........#................#...#.......\n" +
    "............#........................#................#.................#........................#.............#.......#..........\n" +
    "........#.#................................#.....................................................#................................\n" +
    ".#...#............#........#........#..#...............................................#............................#............#\n" +
    "...#.............#.........#....................................#..............#.......................................##.........\n" +
    "...#...........#.....................................#.........#................#......................#............#.............\n" +
    "..................#....................................................##.......##..........#...............................##....\n" +
    "........................#.........#...........#............................................................###....................\n" +
    "....................#.......#....................................................#...#..............................#............#\n" +
    "............................#.....................................................................................................\n" +
    "......#........#........................#..........#..........#.......#..........................#................................\n" +
    "....................................#..............#...#.#......................................................................#.\n" +
    ".....#.....#...#..............................................###......#..............#.........##......#...............#.........\n" +
    "........................#.........................#...............#...............#.#........#.....................#.#............\n" +
    "...............#..............#........#........................................#..........#........#......#......................\n" +
    ".....................#..........................#...............................#........#.......#.....#...................#......\n" +
    ".........#...........................................#.............................#....#.......#......#..#....#..................\n" +
    ".........#...#........#....................#.......#..#...#..............................................................#........\n" +
    "..................#......................................#........................................................................\n" +
    "........#.....................................................#..#...........#........#......................#...#....#.....#.....\n" +
    "...........................#........#....#.........................................................#.............#................\n" +
    ".....#.#.........#................................................................................#...............................\n" +
    "...#............................................#......................#.......#.#...............#............#...................\n" +
    ".........#................................#.....#...........#.#....................#...#.....................................#.#..\n" +
    "..........#.#....#......#.........#....#.....#........#...........................#...............................................\n" +
    "............#...............#............#..........#.............................#...............................................\n" +
    "#.#............#.....................##................................................#....#.................##.................."

const testInput = "....#.....\n" +
    ".........#\n" +
    "..........\n" +
    "..#.......\n" +
    ".......#..\n" +
    "..........\n" +
    ".#..^.....\n" +
    "........#.\n" +
    "#.........\n" +
    "......#..."

const grid = input.split('\n').map((row) => row.split(''))

const rowLength = grid[0].length
const gridLength = grid.length

const visited = 'X'
const block = '#'
const directionUp = '^'
const directionRight = '>'
const directionLeft = '<'
const directionDown = 'v'


function findStartPoint() {
    const coordinates = { x: 0, y: 0 }

    for(let rowI = 0; rowI < grid.length - 1; rowI++) {
        if(grid[rowI].includes(directionUp)) {
            const x = grid[rowI].findIndex((el) => el === directionUp)

            coordinates['x'] = x
            coordinates['y'] = rowI
            break;
        }
    }

    return coordinates
}

let guardCoordintates = findStartPoint()

const isGuardInBound = ({ x, y })  => (0 <= x && x < rowLength) && (0 <= y && y < gridLength)

const markVisited = ({ x, y }) => grid[y][x] = visited

function goUp(coord) {
    markVisited(coord)
    grid[coord.y - 1][coord.x] = directionUp
    guardCoordintates.y = guardCoordintates.y - 1
}

function goRight(coord) {
    markVisited(coord)
    grid[coord.y][coord.x + 1] = directionRight
    guardCoordintates.x = guardCoordintates.x + 1
}

function goLeft(coord) {
    markVisited(coord)
    grid[coord.y][coord.x - 1] = directionLeft
    guardCoordintates.x = guardCoordintates.x - 1
}

function goDown(coord) {
    markVisited(coord)
    grid[coord.y + 1][coord.x] = directionDown
    guardCoordintates.y = guardCoordintates.y + 1
}

const getGuardDirection = ({ x, y })  => grid[y][x]

function getNextGuardCoordinates(coord, direction) {
    switch(direction) {
        case directionUp:
            return { y: coord.y - 1, x: coord.x}

        case directionRight:
            return { y: coord.y, x: coord.x + 1}

        case directionLeft:
            return { y: coord.y, x: coord.x - 1}

        case directionDown:
            return { y: coord.y + 1, x: coord.x}

        default:
            throw new Error(`[getNextGuardCoordinates] Unknown direction: ${direction}`)
    }
}

const isPossibleToGo = (coord) => grid[coord.y][coord.x] !== block

function go(coord, direction) {
    switch (direction) {
        case directionUp:
            return goUp(coord)

        case directionRight:
            return goRight(coord)

        case directionLeft:
            return goLeft(coord)

        case directionDown:
            return goDown(coord)
    }
}

function changeDirection(coord, direction) {
    const { x, y } = coord

    switch (direction) {
        case directionUp:
            return grid[y][x] = directionRight;

        case directionRight:
            return grid[y][x] = directionDown;

        case directionLeft:
            return grid[y][x] = directionUp;

        case directionDown:
            return grid[y][x] = directionLeft
    }
}

let steps = 0
let direction = getGuardDirection(guardCoordintates)

while(isGuardInBound(getNextGuardCoordinates(guardCoordintates, direction))) {
    direction = getGuardDirection(guardCoordintates)

    if(isPossibleToGo(getNextGuardCoordinates(guardCoordintates, direction))) {
        if(getGuardDirection(getNextGuardCoordinates(guardCoordintates, direction)) !== visited) {
            steps += 1
        }

        go(guardCoordintates, direction)

        continue
    }

    changeDirection(guardCoordintates, direction);
}


console.log(steps + 1)
