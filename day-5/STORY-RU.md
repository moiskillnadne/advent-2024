# День 5: Очередь печати

Удовлетворенные своими изысканиями на Церере, отряд ученых предлагает продолжить исследование канцелярских запасов в подвале на уровне -17.

Печатный отдел на Северном полюсе работает на пределе возможностей в преддверии Рождества, и пока Историки продолжают свой поиск в этом исторически значимом объекте, Эльф, работающий за очень знакомым принтером, манит вас к себе.

Кажется, Эльф вас узнал, потому что без промедления объясняет, что обновления руководств по технике безопасности для запуска новых саней печатаются неправильно. Если не обновить руководства по безопасности, последствия будут крайне серьезными, поэтому вы предлагаете свою помощь.

Протоколы безопасности четко указывают, что новые страницы для руководств должны быть напечатаны в очень определенном порядке. Обозначение X|Y означает, что если и страница с номером X, и страница с номером Y входят в обновление, страница X должна быть напечатана в какой-то момент раньше страницы Y.

Эльф передает вам как правила упорядочения страниц, так и номера страниц для каждого обновления (ваши входные данные головоломки), но не может понять, в правильном ли порядке идут страницы в каждом обновлении.

**Например:**

````
47|53
97|13
97|61
97|47
75|29
61|13
75|53
29|13
97|29
53|29
61|53
97|53
61|29
47|13
75|47
97|75
47|61
75|61
47|29
75|13
53|13

75,47,61,53,29
97,61,53,29,13
75,29,13
75,97,47,61,53
61,13,29
97,13,75,29,47
````

В первой части указаны правила упорядочения страниц, по одному правилу на строку. Первое правило, 47|53, означает, что если обновление включает и страницу №47, и страницу №53, то страница №47 должна быть напечатана раньше страницы №53. (47 не обязательно должна идти непосредственно перед 53; между ними могут быть и другие страницы.)

Во второй части перечислены номера страниц для каждого обновления. Поскольку большинство руководств по безопасности различаются, для обновлений требуются разные наборы страниц. Первое обновление, 75,47,61,53,29, означает, что обновление состоит из страниц с номерами 75, 47, 61, 53 и 29.

Чтобы принтеры заработали как можно скорее, сначала определите, какие обновления уже идут в правильном порядке.

В приведенном примере первое обновление (75,47,61,53,29) идет в правильном порядке:

75 - стоит на первом месте правильно, потому что есть правила, ставящие все остальные страницы после нее: 75|47, 75|61, 75|53 и 75|29.

47 - стоит вторым правильно, так как 75 должна быть перед ним (75|47), а все остальные страницы должны быть после него, согласно 47|61, 47|53 и 47|29.

61 - находится посередине правильно, поскольку 75 и 47 идут перед ним (75|61 и 47|61), а 53 и 29 – после него (61|53 и 61|29).

53 - стоит на четвертом месте правильно, поскольку она должна идти перед страницей №29 (53|29).

29 – единственная оставшаяся страница и, соответственно, она правильно стоит последней.

Поскольку первое обновление не включает некоторые номера страниц, правила упорядочения, связанные с отсутствующими страницами, игнорируются.

Второе и третье обновления также идут в правильном порядке согласно правилам. Как и в первом обновлении, они не включают все страницы, и потому применяются только те правила, которые касаются присутствующих в обновлении страниц.

Четвертое обновление, 75,97,47,61,53, не в правильном порядке: оно ставит 75 перед 97, что нарушает правило 97|75.

Пятое обновление, 61,13,29, тоже не в правильном порядке, так как оно нарушает правило 29|13.

Последнее обновление, 97,13,75,29,47, также не в правильном порядке, поскольку нарушает несколько правил.

По какой-то причине Эльфам также нужно узнать, какая страница является «средней» в каждом обновлении. Поскольку вы в данный момент печатаете только те обновления, которые уже упорядочены правильно, вам нужно найти средний номер страницы каждого из этих обновлений. В приведенном примере правильно упорядоченные обновления следующие:

````
75,47,61,53,29
97,61,53,29,13
75,29,13
````

У них средние страницы соответственно 61, 53 и 29. Сложив их номера, вы получите 143.

Конечно, нужно быть внимательными: фактический список правил упорядочения страниц больше и сложнее, чем в приведенном примере.

Определите, какие обновления уже находятся в правильном порядке. **Что получится, если сложить средние номера страниц всех таких обновлений?**

## Часть вторая

Пока Эльфы занимаются печатью уже правильно упорядоченных обновлений, у вас есть немного времени, чтобы исправить остальные.

Для каждого неправильно упорядоченного обновления используйте правила упорядочения страниц, чтобы расставить номера в правильном порядке. В примере ниже показаны три неправильно упорядоченных обновления и их правильная сортировка:

75,97,47,61,53 становится 97,75,47,61,53.

61,13,29 становится 61,29,13.

97,13,75,29,47 становится 97,75,47,29,13.

После того как вы возьмете только неправильно упорядоченные обновления, упорядочите их правильно и определите их средние страницы, вы получите для них средние номера 47, 29 и 47. Сложив их, вы получите 123.

Найдите обновления, которые не в правильном порядке. Что вы получите, если сложите средние номера страниц после того, как правильно упорядочите только эти обновления?
```